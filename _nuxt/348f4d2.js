(window.webpackJsonp=window.webpackJsonp||[]).push([[25,9],{319:function(e,t,n){var content=n(338);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(47).default)("1f1cca64",content,!0,{sourceMap:!1})},321:function(e,t,n){"use strict";n.r(t);var o=n(393),l=n.n(o),r={name:"BlocklyComponent",props:["options","value"],data:function(){return{workspace:null,initialValue:this.$props.value}},mounted:function(){console.log("start mounted component");var e=this.$props.options||{};e.toolbox||(e.toolbox=this.$refs.blocklyToolbox),this.workspace=l.a.inject(this.$refs.blocklyDiv,e);var t=l.a.Xml.textToDom(this.initialValue);l.a.Xml.domToWorkspace(t,this.workspace),console.log("end mounted component")},methods:{injectCode:function(e){var t=l.a.Xml.textToDom(e);this.workspace.clear(),l.a.Xml.domToWorkspace(t,this.workspace)},injectAdditionCode:function(e){var t=l.a.Xml.textToDom(e);console.log("blockly component get xml",t),l.a.Xml.domToWorkspace(t,this.workspace)},getCode:function(){var e=l.a.Xml.workspaceToDom(this.workspace);return l.a.Xml.domToText(e)}},beforeDestroy:function(){console.log("this is the line i need to see!!!!!!!!!!!!!!!!!");var code=this.getCode();console.log("blockly components"),console.log(code),this.$emit("input",code)}},c=(n(337),n(45)),component=Object(c.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{width:"100%"}},[n("div",{ref:"blocklyDiv",staticClass:"blocklyDiv"}),e._v(" "),e._m(0)],1)}),[function(){var e=this,t=e.$createElement;return(e._self._c||t)("xml",{pre:!0,attrs:{ref:"blocklyToolbox",style:"display: none"}},[e._t("default")],2)}],!1,null,"2b0f13a6",null);t.default=component.exports},337:function(e,t,n){"use strict";n(319)},338:function(e,t,n){var o=n(46)(!1);o.push([e.i,".blocklyDiv[data-v-2b0f13a6]{height:500px;width:100%;text-align:left;z-index:100}",""]),e.exports=o},353:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));n(48),n(104),n(103),n(62),n(63),n(323);var o=n(336),l=(n(327),200);function r(e,t){""===(t=t.split("#$"))[t.length-1]&&t.pop();var code=t=t.join("\n###"+e);return"("+(code=(code=code.replace(/ /g,"")).replace(/#/g," "))+")"}console.log(o),o.defineBlocksWithJsonArray([{type:"data_type",message0:"資料 %1",args0:[{type:"field_input",name:"dataName",text:"price:收盤價"}],output:null,colour:230,tooltip:"",helpUrl:""},{type:"indicator",message0:"技術指標 %1",args0:[{type:"field_input",name:"dataName",text:"RSI(timeperiod=20)"}],output:null,colour:230,tooltip:"",helpUrl:""},{type:"df_rolling",message0:"近 %1 筆 %2 的 %3",args0:[{type:"field_number",name:"window",value:10},{type:"input_value",name:"df"},{type:"field_dropdown",name:"operation",options:[["平均","mean"],["總和","sum"],["最大值","max"],["最小值","min"]]}],inputsInline:!0,output:null,colour:200,tooltip:"",helpUrl:""},{type:"backtest",message0:"回測條件 %1 %2  %3 換股頻率 %4",args0:[{type:"field_dropdown",name:"operator",options:[["and","&"],["or","|"]]},{type:"input_dummy"},{type:"input_statement",name:"total_conditions"},{type:"field_dropdown",name:"rebalance_frequency",options:[["每日","D"],["每週","W"],["每月","M"],["每季","Q"]]}],inputsInline:!1,colour:0,tooltip:"",helpUrl:""},{type:"numerical_operator",message0:"%1 %2 %3 %4",args0:[{type:"input_value",name:"val_1"},{type:"field_dropdown",name:"operations",options:[["+","+"],["-","-"],["x","*"],["/","/"]]},{type:"input_dummy"},{type:"input_value",name:"val_2"}],inputsInline:!0,output:null,colour:l,tooltip:"",helpUrl:""},{type:"inequality",message0:"%1 %2 %3 %4",args0:[{type:"input_value",name:"val_1"},{type:"field_dropdown",name:"inequality",options:[[">",">"],["≥",">="],["<","<"],["≤","<="],["=","="]]},{type:"input_dummy"},{type:"input_value",name:"val_2"}],previousStatement:null,nextStatement:null,colour:l,tooltip:"",helpUrl:""},{type:"logic_conditions",message0:"%1 條件: %2 %3",args0:[{type:"field_dropdown",name:"operator",options:[["and","&&"],["or","||"]]},{type:"input_dummy"},{type:"input_statement",name:"Condition"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:50,tooltip:"",helpUrl:""},{type:"sort",message0:"%1 %2 %3",args0:[{type:"field_dropdown",name:"option",options:[["前","nlargest"],["後","nsmallest"]]},{type:"field_number",name:"threshold",value:10},{type:"field_dropdown",name:"unit",options:[["名","n"],["%","percent"]]}],message1:"%1",args1:[{type:"input_value",name:"value"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:200,tooltip:"",helpUrl:""},{type:"sort_condition",message0:"符合條件 %1 %2 %3",args0:[{type:"field_dropdown",name:"operator",options:[["And","&"],["Or","|"]]},{type:"input_dummy",name:"dummy"},{type:"input_statement",name:"statements"}],message1:"的股票中，數值 %1 排名 %2 %3 %4",args1:[{type:"input_value",name:"value"},{type:"field_dropdown",name:"option",options:[["前","nlargest"],["後","nsmallest"]]},{type:"field_number",name:"threshold",value:10},{type:"field_dropdown",name:"unit",options:[["名","n"],["%","percent"]]}],inputsInline:!1,previousStatement:null,nextStatement:null,colour:50,tooltip:"",helpUrl:""},{type:"shift",message0:"前 %1 筆 %2",args0:[{type:"field_number",name:"nshift",value:1,min:0},{type:"input_value",name:"df"}],inputsInline:!1,output:null,colour:l,tooltip:"",helpUrl:""}]),o.Python.sort_condition=function(e){var t=e.getFieldValue("option"),n=e.getFieldValue("threshold"),l=e.getFieldValue("unit"),c=o.Python.valueToCode(e,"value",o.Python.ORDER_ATOMIC),d=o.Python.statementToCode(e,"statements");d=r(e.getFieldValue("operator"),d);var code="(((".concat(c,") * (").concat(d,"))");return"nlargest"===t&&"n"===l?code+=".astype(float).is_largest("+n+"))":"nsmallest"===t&&"n"===l?code+=".astype(float).is_smallest("+n+"))":"nlargest"===t&&"percent"===l?code+=".rank(pct=True) > ".concat(n/100,"))"):"nsmallest"===t&&"percent"===l&&(code+=".rank(pct=True) < ".concat(n/100,"))")),code},o.Python.sort=function(e){var t=e.getFieldValue("option"),n=e.getFieldValue("threshold"),l=e.getFieldValue("unit"),r=o.Python.valueToCode(e,"value",o.Python.ORDER_ATOMIC),code="";return"nlargest"===t&&"n"===l?code=r+".is_largest("+n+")":"nsmallest"===t&&"n"===l?code=r+".is_smallest("+n+")":"nlargest"===t&&"percent"===l?code="("+r+".rank(pct=True) > ".concat(n/100,")"):"nsmallest"===t&&"percent"===l&&(code="("+r+".rank(pct=True) < ".concat(n/100,")")),code},o.Python.backtest=function(e){var t=e.getFieldValue("operator"),n=o.Python.statementToCode(e,"total_conditions"),l=o.Python.valueToCode(e,"weight",o.Python.ORDER_ATOMIC),c=e.getFieldValue("rebalance_frequency"),code="from finlab import backtest\n";return code+="from finlab import data\n\n",code+="buy = "+r(t,n)+"\n\n",code+=l?"weight = "+l+"\n":"weight = None\n",code+='backtest.sim(buy, weight=weight, resample="'+c+'")\n'},o.Python.df_rolling=function(e){var t=e.getFieldValue("window"),n=o.Python.valueToCode(e,"df",o.Python.ORDER_ATOMIC),l=e.getFieldValue("operation");return["(".concat(n,").rolling(").concat(t,").").concat(l,"()"),o.Python.ORDER_NONE]},o.Python.logic_conditions=function(e){return[r(e.getFieldValue("operator"),o.Python.statementToCode(e,"Condition")),o.Python.ORDER_NONE]},o.Python.data_type=function(e){var t=e.getFieldValue("dataName");return['data.get("'.concat(t,'")'),o.Python.ORDER_NONE]},o.Python.indicator=function(e){var t=e.getFieldValue("dataName"),n=t.split("(")[0],l=t.split("(")[1].replace(")","");return['data.indicator("'.concat(n,'", ').concat(l,")"),o.Python.ORDER_NONE]},o.Python.numerical_operator=function(e){var t=o.Python.valueToCode(e,"val_1",o.Python.ORDER_ATOMIC),n=e.getFieldValue("operations"),l=o.Python.valueToCode(e,"val_2",o.Python.ORDER_ATOMIC);return["(".concat(t).concat(n).concat(l,")"),o.Python.ORDER_NONE]},o.Python.inequality=function(e){var t=o.Python.valueToCode(e,"val_1",o.Python.ORDER_ATOMIC),n=e.getFieldValue("inequality"),l=o.Python.valueToCode(e,"val_2",o.Python.ORDER_ATOMIC);return"(".concat(t).concat(n).concat(l,")")+"#$"},o.Python.shift=function(e){var t=e.getFieldValue("nshift"),n=o.Python.valueToCode(e,"df",o.Python.ORDER_ATOMIC);return["(".concat(n,").shift(").concat(t,")"),o.Python.ORDER_NONE]};var c=o},509:function(e,t,n){var content=n(584);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(47).default)("1eafedf8",content,!0,{sourceMap:!1})},583:function(e,t,n){"use strict";n(509)},584:function(e,t,n){var o=n(46)(!1);o.push([e.i,".blocklyFlyoutBackground{fill:#fbfafb}.blocklyMainBackground{stroke:#fff}",""]),e.exports=o},616:function(e,t,n){"use strict";n.r(t);n(48),n(62);var o=n(353),l=n(327),r=n.n(l),c=n(321);o.a.HSV_SATURATION=.3,o.a.HSV_VALUE=.8;var d={name:"app",components:{BlocklyComponent:c.default},data:function(){return{code:"",options:{grid:{spacing:25,length:3,colour:"white",snap:!1},collapse:!0,comments:!1,disable:!1,maxBlocks:1/0,trashcan:!1,horizontalLayout:!1,scrollbars:!0,sounds:!0,oneBasedIndex:!1,toolbox:'<xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">\n    <block type="data_type">\n      <field name="NAME">price:收盤價</field>\n    </block>\n    <block type="indicator">\n      <field name="NAME"></field>\n    </block>\n    <block type="math_number">\n      <field name="NUM">0</field>\n    </block>\n    <block type="inequality">\n      <field name="inequality">&gt;</field>\n    </block>\n    <block type="numerical_operator">\n      <field name="operations">+</field>\n    </block>\n    <block type="df_rolling">\n      <field name="window">10</field>\n      <field name="operation">mean</field>\n    </block>\n    <block type="sort">\n      <field name="option">nlargest</field>\n      <field name="threshold">10</field>\n      <field name="unit">n</field>\n    </block>\n    <block type="shift">\n      <field name="nshift">1</field>\n    </block>\n    <block type="logic_conditions">\n      <field name="operator">&amp;&amp;</field>\n    </block>\n    <block type="sort_condition">\n      <field name="option">nlargest</field>\n      <field name="threshold">10</field>\n      <field name="unit">n</field>\n    </block>\n    <block type="backtest">\n      <field name="operator">&amp;=</field>\n      <field name="rebalance_frequency">D</field>\n    </block>\n  </xml>'}}},methods:{getCode:function(){this.code=r.a.workspaceToCode(this.$refs.foo.workspace),this.code=this.code.replace(/#\$/g,"");var e=o.a.workspaceToDom(this.$refs.foo.workspace),t=o.a.Xml.domToText(e);return[this.code,t]},injectCode:function(e){this.$refs.foo.injectCode(e)}}},m=(n(583),n(45)),component=Object(m.a)(d,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("BlocklyComponent",{ref:"foo",attrs:{id:"blockly2",options:e.options}})}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{BlocklyComponent:n(321).default})}}]);