(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{502:function(t,e,r){var content=r(549);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(47).default)("55def65a",content,!0,{sourceMap:!1})},503:function(t,e,r){var content=r(551);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(47).default)("0b54578a",content,!0,{sourceMap:!1})},548:function(t,e,r){"use strict";r(502)},549:function(t,e,r){var o=r(46)(!1);o.push([t.i,".ql-editor{font-size:20px!important;min-height:200px;border:0}.ql-toolbar{z-index:3000}",""]),t.exports=o},550:function(t,e,r){"use strict";r(503)},551:function(t,e,r){var o=r(46)(!1);o.push([t.i,'.switch[data-v-08988e8b]{position:relative;display:inline-block;width:60px;height:34px}.switch input[data-v-08988e8b]{opacity:0;width:0;height:0}.slider[data-v-08988e8b]{cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc}.slider[data-v-08988e8b],.slider[data-v-08988e8b]:before{position:absolute;transition:.4s}.slider[data-v-08988e8b]:before{content:"";height:26px;width:26px;left:4px;bottom:4px;background-color:#fff}input:checked+.slider[data-v-08988e8b]{background-color:#252786}input:focus+.slider[data-v-08988e8b]{box-shadow:0 0 1px #252786}input:checked+.slider[data-v-08988e8b]:before{transform:translateX(26px)}.slider.round[data-v-08988e8b]{border-radius:34px}.slider.round[data-v-08988e8b]:before{border-radius:50%}',""]),t.exports=o},610:function(t,e,r){"use strict";r.r(e);var o=r(11),n=(r(61),r(37),r(103),r(48),r(104),r(14),r(82),r(534),r(36),r(536),r(538),r(540),r(4)),l=r(33);function c(t){return{postId:null,post:{title:"",content:"",tags:[],visibleLevel:0,coin:0,postThumbnail:null,authorUid:t.$store.state.user.uid,authorName:t.$store.state.user.displayName,authorThumbnail:t.$store.state.user.photoURL,authorRole:t.$store.state.role,views:0,likes:0},strategy:null,position:null,code:null,editorOption:{theme:"snow",placeholder:"分享超棒的研究心得!!",modules:{syntax:{highlight:function(text){return window.hljs.highlightAuto(text).value}},toolbar:[["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{header:[2,3,!1]}],[{color:[]},{background:[]}],[{size:["small",!1,"large","huge"]}],[{align:[]}],["link","image"],["clean"],["video"],["code-block"]]}},strategies:{},selectedStrategy:null,sharePerformance:!1,shareStocks:!1,shareCode:!1}}var d={components:{quillEditor:r(542).quillEditor},data:function(){return c(this)},mounted:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,o,n,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,e.prev=1,e.next=4,t.getDB(["users",t.$store.state.user.uid]);case 4:r=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),alert("cannot fetch user strategy list"+e.t0),e.abrupt("return");case 11:if(t.strategies=r.strategies,t.postId=t.$route.query.postId||null,void 0!==t.$route.query.tag?t.post.tags=[t.$route.query.tag]:t.post.tags=[],null!==t.postId){e.next=16;break}return e.abrupt("return");case 16:return o=l.d.ref().child("posts/"+t.postId),n=null,e.prev=18,e.next=21,o.getDownloadURL();case 21:n=e.sent,e.next=30;break;case 24:return e.prev=24,e.t1=e.catch(18),alert("cannot get url for post ".concat(t.postId)),t.postId=null,t.$router.push({path:"postEditing"}),e.abrupt("return");case 30:return e.next=32,t.$axios.get(n);case 32:c=e.sent,console.log(c),Object.assign(t.post,c.data.post||{}),t.strategy=c.data.strategy||null,t.code=c.data.code||null,t.position=c.data.position||null,null!==t.strategy&&(t.selectedStrategy=t.strategy.name),t.shareStocks=null!==t.position,t.sharePerformance=null!==t.strategy,t.shareCode=null!==t.code;case 42:case"end":return e.stop()}}),e,null,[[1,7],[18,24]])})))()},methods:{fetchStrategy:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.selectedStrategy){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.getDB(["users",t.$store.state.user.uid,"strategies",t.selectedStrategy]);case 5:t.strategy=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),alert("fetchStrategy: cannot get startegy",t.selectedStrategy);case 11:t.code=t.strategy.code,delete t.strategy.code,t.fetchPosition();case 14:case"end":return e.stop()}}),e,null,[[2,8]])})))()},fetchPosition:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.strategy){e.next=6;break}return alert("請先選擇策略"),t.sharePerformance=!1,t.shareStocks=!1,t.shareCode=!1,e.abrupt("return");case 6:return e.prev=6,e.next=9,t.getDB(["users",t.$store.state.user.uid,"strategies",t.selectedStrategy,"positions",t.strategy.position_id]);case 9:t.position=e.sent,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),alert("cannot get startegy",t.selectedStrategy);case 15:case"end":return e.stop()}}),e,null,[[6,12]])})))()},getDB:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var r,o,n,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=t.join("/"),o=l.c;0!==t.length;)n=t.shift(),c=t.shift(),o=o.collection(n).doc(c);return d=null,e.next=6,o.get();case 6:if((d=e.sent).exists){e.next=9;break}throw new Error("".concat(r," does not exist"));case 9:return e.abrupt("return",d.data());case 10:case"end":return e.stop()}}),e)})))()},reversedNum:function(t){return parseFloat(t.toString().split("").reverse().join(""))*Math.sign(t)},uploadPost:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,o,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===t.postId&&(r=t.$store.state.user.uid,t.postId=[t.reversedNum(Date.now()),t.post.title,r].join("_")),o=l.d.ref().child("posts/"+t.postId),n={customMetadata:{visibleLevel:t.post.visibleLevel,authorUid:t.post.authorUid}},e.prev=3,e.next=6,o.putString(JSON.stringify({post:t.post,strategy:t.sharePerformance?t.strategy:null,code:t.shareCode?t.code:null,position:t.shareStocks?t.position:null}),"raw",n);case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(3),alert("uploadPost: cannot upolad post! "+e.t0),e.abrupt("return");case 12:t.$router.push({path:"post",query:{postId:t.postId}}),alert("upload success!");case 14:case"end":return e.stop()}}),e,null,[[3,8]])})))()},deletePost:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.d.ref().child("posts/"+t.postId).delete();case 3:return e.next=5,l.c.collection("posts").where("postIds","array-contains",t.postId).get();case 5:e.sent.forEach((function(e){var r={postIds:n.a.firestore.FieldValue.arrayRemove(t.postId)};r["details."+t.$store.state.user.uid+"."+t.postId]=n.a.firestore.FieldValue.delete(),console.log(r),e.ref.update(r)})),e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(0),alert("deletePost:cannot delete post: "+e.t0),e.abrupt("return");case 13:t.$router.push({path:"postEditing"}),delete(r=c(t)).strategies,Object.assign(t.$data,r),t.$router.push({path:"/posts",query:{tags:t.post.tags.join(",")}});case 18:case"end":return e.stop()}}),e,null,[[0,9]])})))()}}},v=(r(548),r(550),r(45)),component=Object(v.a)(d,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"uk-container uk-container-small"},[r("fieldset",{staticClass:"uk-fieldset"},[r("form",{staticClass:"uk-grid-small uk-padding uk-padding-remove-left uk-padding-remove-right",attrs:{"uk-grid":""}},[r("div",{staticClass:"uk-width-3-4@s uk-width-1-1"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.post.title,expression:"post.title"}],staticClass:"uk-input",staticStyle:{border:"0px","font-size":"36px","padding-left":"0"},attrs:{type:"text",placeholder:"新文章標題"},domProps:{value:t.post.title},on:{input:function(e){e.target.composing||t.$set(t.post,"title",e.target.value)}}})]),t._v(" "),r("div",{staticClass:"uk-width-1-4@s uk-width-1-1",attrs:{"uk-form-custom":"target: > * > span:first-child"}},[r("select",{directives:[{name:"model",rawName:"v-model",value:t.post.tags,expression:"post.tags"}],on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.post,"tags",e.target.multiple?r:r[0])}}},[r("option",{domProps:{value:[]}},[t._v("\n            "+t._s(null===t.$route.query.tag?"貼文類別":"sharing"===t.$route.query.tag?"類別：分享":"類別：提問")+"\n          ")]),t._v(" "),r("option",{domProps:{value:["sharing"]}},[t._v("分享")]),t._v(" "),r("option",{domProps:{value:["question"]}},[t._v("提問")])]),t._v(" "),t._m(0)])]),t._v(" "),r("div",[r("quill-editor",{ref:"myQuillEditor",attrs:{options:t.editorOption},model:{value:t.post.content,callback:function(e){t.$set(t.post,"content",e)},expression:"post.content"}})],1),t._v(" "),r("div",{staticClass:"uk-background-muted uk-child-width-1-3@s",staticStyle:{border:"1px solid #dbddff","margin-left":"0"},attrs:{"uk-grid":""}},[r("div",{directives:[{name:"show",rawName:"v-show",value:t.post.tags.includes("sharing"),expression:"post.tags.includes('sharing')"}],staticClass:"uk-padding"},[r("h4",[t._v("策略分享")]),t._v(" "),r("div",{staticStyle:{display:"inline"},attrs:{"uk-form-custom":"target: > * > span:first-child"}},[r("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedStrategy,expression:"selectedStrategy"}],on:{change:[function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.selectedStrategy=e.target.multiple?r:r[0]},t.fetchStrategy]}},[r("option",{domProps:{value:null}},[t._v("\n              "+t._s(null!==t.postId?"更改策略":"選擇策略")+"\n            ")]),t._v(" "),t._l(t.strategies,(function(s,e){return r("option",{key:e,domProps:{value:e}},[t._v("\n              "+t._s(e)+"\n            ")])}))],2),t._v(" "),t._m(1)]),t._v(" "),r("div",{staticStyle:{height:"34px","line-height":"34px","margin-top":"16px"}},[r("label",{staticClass:"switch",staticStyle:{"margin-right":"20px"}},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.sharePerformance,expression:"sharePerformance"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.sharePerformance)?t._i(t.sharePerformance,null)>-1:t.sharePerformance},on:{change:function(e){var r=t.sharePerformance,o=e.target,n=!!o.checked;if(Array.isArray(r)){var l=t._i(r,null);o.checked?l<0&&(t.sharePerformance=r.concat([null])):l>-1&&(t.sharePerformance=r.slice(0,l).concat(r.slice(l+1)))}else t.sharePerformance=n}}}),t._v(" "),r("span",{staticClass:"slider round"})]),t._v("績效分享\n        ")]),t._v(" "),r("div",{staticStyle:{height:"34px","line-height":"34px","margin-top":"16px"}},[r("label",{staticClass:"switch",staticStyle:{"margin-right":"20px"}},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.shareStocks,expression:"shareStocks"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.shareStocks)?t._i(t.shareStocks,null)>-1:t.shareStocks},on:{change:function(e){var r=t.shareStocks,o=e.target,n=!!o.checked;if(Array.isArray(r)){var l=t._i(r,null);o.checked?l<0&&(t.shareStocks=r.concat([null])):l>-1&&(t.shareStocks=r.slice(0,l).concat(r.slice(l+1)))}else t.shareStocks=n}}}),t._v(" "),r("span",{staticClass:"slider round"})]),t._v("股票清單分享\n        ")]),t._v(" "),r("div",{staticStyle:{height:"34px","line-height":"34px","margin-top":"16px"}},[r("label",{staticClass:"switch",staticStyle:{"margin-right":"20px"}},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.shareCode,expression:"shareCode"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.shareCode)?t._i(t.shareCode,null)>-1:t.shareCode},on:{change:function(e){var r=t.shareCode,o=e.target,n=!!o.checked;if(Array.isArray(r)){var l=t._i(r,null);o.checked?l<0&&(t.shareCode=r.concat([null])):l>-1&&(t.shareCode=r.slice(0,l).concat(r.slice(l+1)))}else t.shareCode=n}}}),t._v(" "),r("span",{staticClass:"slider round"})]),t._v("程式碼分享\n        ")])]),t._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:t.post.tags.includes("sharing"),expression:"post.tags.includes('sharing')"}],staticClass:"uk-padding"},[r("h4",[t._v("觀看權限")]),t._v(" "),r("div",{staticStyle:{display:"inline"},attrs:{"uk-form-custom":"target: > * > span:first-child"}},[r("select",{directives:[{name:"model",rawName:"v-model",value:t.post.visibleLevel,expression:"post.visibleLevel"}],on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.post,"visibleLevel",e.target.multiple?r:r[0])}}},[r("option",{domProps:{value:0}},[t._v("一般")]),t._v(" "),r("option",{domProps:{value:-1}},[t._v("隱藏")]),t._v(" "),r("option",{domProps:{value:1}},[t._v("VIP1")])]),t._v(" "),t._m(2)]),t._v(" "),r("h4",[t._v("文章縮圖")]),t._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:t.post.postThumbnail,expression:"post.postThumbnail"}],staticClass:"uk-input",attrs:{type:"text",placeholder:"網址"},domProps:{value:t.post.postThumbnail},on:{input:function(e){e.target.composing||t.$set(t.post,"postThumbnail",e.target.value)}}})]),t._v(" "),t._m(3)]),t._v(" "),r("button",{staticClass:"uk-margin uk-button uk-button-primary uk-button-large uk-width-1-1 uk-width-1-3@s",on:{click:t.uploadPost}},[t._v("\n      "+t._s(t.postId?"更新":"發佈")+"文章\n    ")])]),t._v(" "),r("div",{attrs:{id:"modal-delete-post","uk-modal":""}},[r("div",{staticClass:"uk-modal-dialog uk-modal-body"},[r("h3",{staticClass:"uk-modal-title"},[t._v("刪除文章")]),t._v(" "),r("p",[t._v("此動作無法復原，確定要刪除文章嗎？")]),t._v(" "),r("p",{staticClass:"uk-text-right"},[r("button",{staticClass:"uk-button uk-button-default uk-modal-close",attrs:{type:"button"},on:{click:t.deletePost}},[t._v("\n          確認\n        ")]),t._v(" "),r("button",{staticClass:"uk-button uk-button-primary",attrs:{type:"button"}},[t._v("\n          取消\n        ")])])])])])}),[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("button",{staticClass:"uk-button uk-button-default uk-width-1-1",attrs:{type:"button",tabindex:"1"}},[r("span"),t._v(" "),r("span",{attrs:{"uk-icon":"icon: chevron-down"}})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("button",{staticClass:"uk-button uk-button-default uk-width-1-1",attrs:{type:"button"}},[r("span"),t._v(" "),r("span",{attrs:{"uk-icon":"icon: chevron-down"}})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("button",{staticClass:"uk-button uk-button-default uk-width-1-1",attrs:{type:"button"}},[r("span"),t._v(" "),r("span",{attrs:{"uk-icon":"icon: chevron-down"}})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"uk-padding"},[r("h4",[t._v("危險區域")]),t._v(" "),r("button",{staticClass:"uk-button uk-button-danger uk-width-1-1",attrs:{type:"button","uk-toggle":"target: #modal-delete-post"}},[t._v("\n          刪除文章\n        ")])])}],!1,null,"08988e8b",null);e.default=component.exports}}]);