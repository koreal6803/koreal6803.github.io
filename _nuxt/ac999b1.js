(window.webpackJsonp=window.webpackJsonp||[]).push([[10,9],{319:function(e,t,o){var content=o(338);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(47).default)("1f1cca64",content,!0,{sourceMap:!1})},321:function(e,t,o){"use strict";o.r(t);var n=o(393),l=o.n(n),r={name:"BlocklyComponent",props:["options","value"],data:function(){return{workspace:null,initialValue:this.$props.value}},mounted:function(){console.log("start mounted component");var e=this.$props.options||{};e.toolbox||(e.toolbox=this.$refs.blocklyToolbox),this.workspace=l.a.inject(this.$refs.blocklyDiv,e);var t=l.a.Xml.textToDom(this.initialValue);l.a.Xml.domToWorkspace(t,this.workspace),console.log("end mounted component")},methods:{injectCode:function(e){var t=l.a.Xml.textToDom(e);this.workspace.clear(),l.a.Xml.domToWorkspace(t,this.workspace)},injectAdditionCode:function(e){var t=l.a.Xml.textToDom(e);console.log("blockly component get xml",t),l.a.Xml.domToWorkspace(t,this.workspace)},getCode:function(){var e=l.a.Xml.workspaceToDom(this.workspace);return l.a.Xml.domToText(e)}},beforeDestroy:function(){console.log("this is the line i need to see!!!!!!!!!!!!!!!!!");var code=this.getCode();console.log("blockly components"),console.log(code),this.$emit("input",code)}},c=(o(337),o(45)),component=Object(c.a)(r,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticStyle:{width:"100%"}},[o("div",{ref:"blocklyDiv",staticClass:"blocklyDiv"}),e._v(" "),e._m(0)],1)}),[function(){var e=this,t=e.$createElement;return(e._self._c||t)("xml",{pre:!0,attrs:{ref:"blocklyToolbox",style:"display: none"}},[e._t("default")],2)}],!1,null,"2b0f13a6",null);t.default=component.exports},329:function(e,t,o){var content=o(373);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(47).default)("05ceb600",content,!0,{sourceMap:!1})},337:function(e,t,o){"use strict";o(319)},338:function(e,t,o){var n=o(46)(!1);n.push([e.i,".blocklyDiv[data-v-2b0f13a6]{height:500px;width:100%;text-align:left;z-index:100}",""]),e.exports=n},351:function(e,t,o){"use strict";o.r(t);o(48),o(62);var n=o(353),l=o(327),r=o.n(l),c=o(321);n.a.HSV_SATURATION=.3,n.a.HSV_VALUE=.8;var d={name:"app",components:{BlocklyComponent:c.default},props:["value"],data:function(){return{xml:this.$props.value,code:"",options:{grid:{spacing:25,length:3,colour:"white",snap:!1},zoom:{controls:!0,wheel:!0,startScale:.9,maxScale:3,minScale:.3,scaleSpeed:1.2},collapse:!0,comments:!1,disable:!1,maxBlocks:1/0,trashcan:!0,horizontalLayout:!1,scrollbars:!0,sounds:!0,oneBasedIndex:!1,toolbox:'<xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">\n    <block type="data_type">\n      <field name="NAME">price:收盤價</field>\n    </block>\n    <block type="indicator">\n      <field name="NAME"></field>\n    </block>\n    <block type="math_number">\n      <field name="NUM">0</field>\n    </block>\n    <block type="inequality">\n      <field name="inequality">&gt;</field>\n    </block>\n    <block type="numerical_operator">\n      <field name="operations">+</field>\n    </block>\n    <block type="df_rolling">\n      <field name="window">10</field>\n      <field name="operation">mean</field>\n    </block>\n    <block type="sort">\n      <field name="option">nlargest</field>\n      <field name="threshold">10</field>\n      <field name="unit">n</field>\n    </block>\n    <block type="shift">\n      <field name="nshift">1</field>\n    </block>\n    <block type="logic_conditions">\n      <field name="operator">&amp;&amp;</field>\n    </block>\n    <block type="sort_condition">\n      <field name="option">nlargest</field>\n      <field name="threshold">10</field>\n      <field name="unit">n</field>\n    </block>\n    <block type="backtest">\n      <field name="operator">&amp;=</field>\n      <field name="rebalance_frequency">D</field>\n    </block>\n  </xml>'}}},mounted:function(){this.injectCode(this.$props.value)},methods:{getCode:function(){return this.code=r.a.workspaceToCode(this.$refs.foo.workspace),this.code=this.code.replace(/#\$/g,""),[this.code,this.$refs.foo.getCode()]},injectCode:function(e){this.$refs.foo.injectCode(e)},injectAdditionCode:function(e){this.$refs.foo.injectAdditionCode(e)}},beforeDestroy:function(){console.log("before destroy event");var code=this.$refs.foo.getCode();this.$emit("input",code)}},m=(o(372),o(45)),component=Object(m.a)(d,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticStyle:{width:"100%"},attrs:{id:"app"}},[o("BlocklyComponent",{ref:"foo",attrs:{id:"blockly2",options:e.options},model:{value:e.xml,callback:function(t){e.xml=t},expression:"xml"}}),e._v(" "),""!==e.code?o("div",{staticClass:"uk-background-default",staticStyle:{"white-space":"pre-line"}},[e._v("\n    "+e._s(e.code)+"\n  ")]):e._e()],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{BlocklyComponent:o(321).default})},353:function(e,t,o){"use strict";o.d(t,"a",(function(){return c}));o(48),o(104),o(103),o(62),o(63),o(323);var n=o(336),l=(o(327),200);function r(e,t){""===(t=t.split("#$"))[t.length-1]&&t.pop();var code=t=t.join("\n###"+e);return"("+(code=(code=code.replace(/ /g,"")).replace(/#/g," "))+")"}console.log(n),n.defineBlocksWithJsonArray([{type:"data_type",message0:"資料 %1",args0:[{type:"field_input",name:"dataName",text:"price:收盤價"}],output:null,colour:230,tooltip:"",helpUrl:""},{type:"indicator",message0:"技術指標 %1",args0:[{type:"field_input",name:"dataName",text:"RSI(timeperiod=20)"}],output:null,colour:230,tooltip:"",helpUrl:""},{type:"df_rolling",message0:"近 %1 筆 %2 的 %3",args0:[{type:"field_number",name:"window",value:10},{type:"input_value",name:"df"},{type:"field_dropdown",name:"operation",options:[["平均","mean"],["總和","sum"],["最大值","max"],["最小值","min"]]}],inputsInline:!0,output:null,colour:200,tooltip:"",helpUrl:""},{type:"backtest",message0:"回測條件 %1 %2  %3 換股頻率 %4",args0:[{type:"field_dropdown",name:"operator",options:[["and","&"],["or","|"]]},{type:"input_dummy"},{type:"input_statement",name:"total_conditions"},{type:"field_dropdown",name:"rebalance_frequency",options:[["每日","D"],["每週","W"],["每月","M"],["每季","Q"]]}],inputsInline:!1,colour:0,tooltip:"",helpUrl:""},{type:"numerical_operator",message0:"%1 %2 %3 %4",args0:[{type:"input_value",name:"val_1"},{type:"field_dropdown",name:"operations",options:[["+","+"],["-","-"],["x","*"],["/","/"]]},{type:"input_dummy"},{type:"input_value",name:"val_2"}],inputsInline:!0,output:null,colour:l,tooltip:"",helpUrl:""},{type:"inequality",message0:"%1 %2 %3 %4",args0:[{type:"input_value",name:"val_1"},{type:"field_dropdown",name:"inequality",options:[[">",">"],["≥",">="],["<","<"],["≤","<="],["=","="]]},{type:"input_dummy"},{type:"input_value",name:"val_2"}],previousStatement:null,nextStatement:null,colour:l,tooltip:"",helpUrl:""},{type:"logic_conditions",message0:"%1 條件: %2 %3",args0:[{type:"field_dropdown",name:"operator",options:[["and","&&"],["or","||"]]},{type:"input_dummy"},{type:"input_statement",name:"Condition"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:50,tooltip:"",helpUrl:""},{type:"sort",message0:"%1 %2 %3",args0:[{type:"field_dropdown",name:"option",options:[["前","nlargest"],["後","nsmallest"]]},{type:"field_number",name:"threshold",value:10},{type:"field_dropdown",name:"unit",options:[["名","n"],["%","percent"]]}],message1:"%1",args1:[{type:"input_value",name:"value"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:200,tooltip:"",helpUrl:""},{type:"sort_condition",message0:"符合條件 %1 %2 %3",args0:[{type:"field_dropdown",name:"operator",options:[["And","&"],["Or","|"]]},{type:"input_dummy",name:"dummy"},{type:"input_statement",name:"statements"}],message1:"的股票中，數值 %1 排名 %2 %3 %4",args1:[{type:"input_value",name:"value"},{type:"field_dropdown",name:"option",options:[["前","nlargest"],["後","nsmallest"]]},{type:"field_number",name:"threshold",value:10},{type:"field_dropdown",name:"unit",options:[["名","n"],["%","percent"]]}],inputsInline:!1,previousStatement:null,nextStatement:null,colour:50,tooltip:"",helpUrl:""},{type:"shift",message0:"前 %1 筆 %2",args0:[{type:"field_number",name:"nshift",value:1,min:0},{type:"input_value",name:"df"}],inputsInline:!1,output:null,colour:l,tooltip:"",helpUrl:""}]),n.Python.sort_condition=function(e){var t=e.getFieldValue("option"),o=e.getFieldValue("threshold"),l=e.getFieldValue("unit"),c=n.Python.valueToCode(e,"value",n.Python.ORDER_ATOMIC),d=n.Python.statementToCode(e,"statements");d=r(e.getFieldValue("operator"),d);var code="(((".concat(c,") * (").concat(d,"))");return"nlargest"===t&&"n"===l?code+=".astype(float).is_largest("+o+"))":"nsmallest"===t&&"n"===l?code+=".astype(float).is_smallest("+o+"))":"nlargest"===t&&"percent"===l?code+=".rank(pct=True) > ".concat(o/100,"))"):"nsmallest"===t&&"percent"===l&&(code+=".rank(pct=True) < ".concat(o/100,"))")),code},n.Python.sort=function(e){var t=e.getFieldValue("option"),o=e.getFieldValue("threshold"),l=e.getFieldValue("unit"),r=n.Python.valueToCode(e,"value",n.Python.ORDER_ATOMIC),code="";return"nlargest"===t&&"n"===l?code=r+".is_largest("+o+")":"nsmallest"===t&&"n"===l?code=r+".is_smallest("+o+")":"nlargest"===t&&"percent"===l?code="("+r+".rank(pct=True) > ".concat(o/100,")"):"nsmallest"===t&&"percent"===l&&(code="("+r+".rank(pct=True) < ".concat(o/100,")")),code},n.Python.backtest=function(e){var t=e.getFieldValue("operator"),o=n.Python.statementToCode(e,"total_conditions"),l=n.Python.valueToCode(e,"weight",n.Python.ORDER_ATOMIC),c=e.getFieldValue("rebalance_frequency"),code="from finlab import backtest\n";return code+="from finlab import data\n\n",code+="buy = "+r(t,o)+"\n\n",code+=l?"weight = "+l+"\n":"weight = None\n",code+='backtest.sim(buy, weight=weight, resample="'+c+'")\n'},n.Python.df_rolling=function(e){var t=e.getFieldValue("window"),o=n.Python.valueToCode(e,"df",n.Python.ORDER_ATOMIC),l=e.getFieldValue("operation");return["(".concat(o,").rolling(").concat(t,").").concat(l,"()"),n.Python.ORDER_NONE]},n.Python.logic_conditions=function(e){return[r(e.getFieldValue("operator"),n.Python.statementToCode(e,"Condition")),n.Python.ORDER_NONE]},n.Python.data_type=function(e){var t=e.getFieldValue("dataName");return['data.get("'.concat(t,'")'),n.Python.ORDER_NONE]},n.Python.indicator=function(e){var t=e.getFieldValue("dataName"),o=t.split("(")[0],l=t.split("(")[1].replace(")","");return['data.indicator("'.concat(o,'", ').concat(l,")"),n.Python.ORDER_NONE]},n.Python.numerical_operator=function(e){var t=n.Python.valueToCode(e,"val_1",n.Python.ORDER_ATOMIC),o=e.getFieldValue("operations"),l=n.Python.valueToCode(e,"val_2",n.Python.ORDER_ATOMIC);return["(".concat(t).concat(o).concat(l,")"),n.Python.ORDER_NONE]},n.Python.inequality=function(e){var t=n.Python.valueToCode(e,"val_1",n.Python.ORDER_ATOMIC),o=e.getFieldValue("inequality"),l=n.Python.valueToCode(e,"val_2",n.Python.ORDER_ATOMIC);return"(".concat(t).concat(o).concat(l,")")+"#$"},n.Python.shift=function(e){var t=e.getFieldValue("nshift"),o=n.Python.valueToCode(e,"df",n.Python.ORDER_ATOMIC);return["(".concat(o,").shift(").concat(t,")"),n.Python.ORDER_NONE]};var c=n},372:function(e,t,o){"use strict";o(329)},373:function(e,t,o){var n=o(46)(!1);n.push([e.i,".blocklyFlyoutBackground{fill:#fbfafb}.blocklyMainBackground{stroke:#fff}",""]),e.exports=n}}]);